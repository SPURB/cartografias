{"version":3,"sources":["main.js"],"names":["$","CARTO","nav","sortable","on","width","this","outerWidth","parent","css","handle","select","e","currentTarget","toggleClass","stopPropagation","filter","el","anySelected","new_text","find","text","errorButton","append","target","appendTo","html","i","separator","data","key","preview","isAppended","url","title","length","attr","scaleScale","imgEl","eq","imgNaturalWidth","naturalWidth","imgClientWidth","clientWidth","imgScaledTo","scaleEl","scaleNaturalWidth","parseInt","checkEmptyInfos","each","addClass","removeClass","trim","showNav","hasClass","expand","bind","$target","$appendTo","window","setTimeout","createMap","scrollTop","remove","dataTitulo","zIndex","save","height","setup","render","filename","getFilename","html2canvas","allowTaint","logging","onrendered","canvas","img","toDataURL","substr","indexOf","toString","carto","stylesheet_directory","submit","cleanup","clone","overflow","toLowerCase","S","latinise","s","jQuery"],"mappings":"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","file":"main.min.js","sourcesContent":["(function($) {\n\t'use strict';\n\tvar CARTO = {\n\t\tnav: {\n\t\t\tsortable: function(){\n\t\t\t\t$('#maps_nav ul')\n\t\t\t\t\t.on('mousedown', 'li', function() {\n\t\t\t\t\t\tvar width = $(this).outerWidth();\n\t\t\t\t\t\t$(this).parent().css({\n\t\t\t\t\t\t\twidth: width\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.on('mouseup', 'li', function() {\n\t\t\t\t\t\t$(this).parent().css({\n\t\t\t\t\t\t\twidth: 'auto'\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.sortable({\n\t\t\t\t\t\thandle: '.handle'\n\t\t\t\t\t});\n\t\t\t},\n\t\t\tselect: function(){\n\t\t\t\t$('#maps_nav input').on('click', function(e){\n\t\t\t\t\t$(e.currentTarget).parent().parent().toggleClass('active');\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t});\n\t\t\t},\n\t\t\tfilter: function() {\n\t\t\t\t$('#filter').on('click', function(el) {\n\t\t\t\t\tif (CARTO.nav.anySelected()) {\n\t\t\t\t\t\t$('#maps_nav').toggleClass('filtered');\n\t\t\t\t\t\tvar new_text = $(el.currentTarget).find('span').text() === 'Filtrar' ? 'Ver todos' : 'Filtrar';\n\t\t\t\t\t\t$(el.currentTarget).find('span').text(new_text);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tCARTO.nav.errorButton( $(e.currentTarget) );\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tappend: function(target, appendTo) {\n\t\t\t\tvar data = $(target).data(),\n\t\t\t\t\tjson,\n\t\t\t\t\thtml,\n\t\t\t\t\ti,\n\t\t\t\t\tseparator;\n\n\t\t\t\tfor (var key in data) {\n\t\t\t\t\tif( key === 'mapa' ){\n\t\t\t\t\t\tif( CARTO.preview.isAppended(key, data[key]) === false){\n\t\t\t\t\t\t\t$(appendTo).find('.'+key).append('<img src=\"'+data[key]+'\">');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if( key === 'legendas' || key === 'relacionados' ){\n\t\t\t\t\t\thtml = '';\n\t\t\t\t\t\ti = 0;\n\t\t\t\t\t\tif(key === 'legendas'){\n\t\t\t\t\t\t\tfor (i in data[key]) {\n\t\t\t\t\t\t\t\tif( CARTO.preview.isAppended(key, data[key][i].url) === false){\n\t\t\t\t\t\t\t\t\thtml += '<img src=\"' + data[key][i].url + '\">';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if(key === 'relacionados'){\n\t\t\t\t\t\t\tfor (i in data[key]) {\n\t\t\t\t\t\t\t\tseparator = '';\n\t\t\t\t\t\t\t\tif (i > 0) {\n\t\t\t\t\t\t\t\t\tseparator = '<span> | </span>';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif( CARTO.preview.isAppended(key, data[key][i].url) === false){\n\t\t\t\t\t\t\t\t\thtml += separator + '<a href=\"' + data[key][i].url + '\">' + data[key][i].title + '</a>';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$(appendTo).find('.'+key).append(html);\n\t\t\t\t\t}\n\t\t\t\t\telse{\n\t\t\t\t\t\tif( CARTO.preview.isAppended(key, data[key]) === false){\n\t\t\t\t\t\t\tseparator = $(appendTo).find('.'+key+' span').length > 0 ? '<span>, </span>' : '';\n\t\t\t\t\t\t\t$(appendTo).find('.'+key).append(separator+'<span>'+data[key]+'</span>');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif( $(appendTo).attr('id') === 'main' ){\n\t\t\t\t\t$('.heading .titulo').html( $('#main .titulo').text() );\n\t\t\t\t}\n\t\t\t\tCARTO.nav.scaleScale(appendTo);\n\t\t\t},\n\t\t\tscaleScale: function(target){\n\t\t\t\tvar imgEl = target.find('.mapa img').eq(0)[0],\n\t\t\t\t\timgNaturalWidth = imgEl.naturalWidth,\n\t\t\t\t\timgClientWidth = imgEl.clientWidth,\n\t\t\t\t\timgScaledTo = ((100 * imgClientWidth) / imgNaturalWidth) / 100,\n\t\t\t\t\tscaleEl = target.find('.escala')[0],\n\t\t\t\t\tscaleNaturalWidth = scaleEl.naturalWidth,\n\t\t\t\t\tscaleScale = parseInt(scaleNaturalWidth * imgScaledTo, 10);\n\t\t\t\t$(scaleEl).css({\n\t\t\t\t\twidth: scaleScale + 'px'\n\t\t\t\t});\n\t\t\t},\n\t\t\tcheckEmptyInfos: function() {\n\t\t\t\t$('.fonte, .elaboracao, .base').each(function(i, el) {\n\t\t\t\t\tif ($(el).find('a').length === 0 && $(el).find('span').length === 0) {\n\t\t\t\t\t\t$(el).addClass('hidden');\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$(el).removeClass('hidden');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif( $.trim( $('.relacionados').text() ) === 'Arquivos relacionados' ){\n\t\t\t\t\t$('.relacionados').addClass('hidden');\n\t\t\t\t} else {\n\t\t\t\t\t$('.relacionados').removeClass('hidden');\n\t\t\t\t}\n\n\t\t\t},\n\t\t\tshowNav: function() {\n\t\t\t\t$('#maps_nav .toggle').on('click', function(el) {\n\t\t\t\t\tif ($('body').hasClass('show_map')) {\n\t\t\t\t\t\t$('.show_map').removeClass('show_map');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\texpand: {\n\t\t\t\tbind: function() {\n\t\t\t\t\t$('li').on('click', function(e) {\n\t\t\t\t\t\tvar $target = $(e.currentTarget);\n\t\t\t\t\t\t$target.toggleClass('expanded');\n\t\t\t\t\t\tif (!$target.hasClass('injected')) {\n\t\t\t\t\t\t\tvar $appendTo \t= $target.find('.more_info');\n\t\t\t\t\t\t\tCARTO.nav.append($target, $appendTo);\n\t\t\t\t\t\t\t$target.addClass('injected');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tanySelected: function() {\n\t\t\t\treturn $('input:checked').length > 0;\n\t\t\t},\n\t\t\terrorButton: function(target){\n\t\t\t\ttarget.addClass('error');\n\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\t$('#save').removeClass('error');\n\t\t\t\t}, 800);\n\t\t\t}\n\t\t},\n\t\tpreview: {\n\t\t\tbind: function() {\n\t\t\t\t$('#preview').on('click', function(e) {\n\t\t\t\t\tif (CARTO.nav.anySelected()) {\n\t\t\t\t\t\tCARTO.preview.createMap();\n\t\t\t\t\t\t$('body').addClass('show_map');\n\t\t\t\t\t\t$('.expanded').removeClass('expanded');\n\t\t\t\t\t\t$('html, body').css({\n\t\t\t\t\t\t\tscrollTop: 0\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tCARTO.nav.errorButton( $(e.currentTarget) );\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tcreateMap: function(){\n\t\t\t\t$('#main').find('img, span, a').remove();\n\t\t\t\t$('#maps_nav li.active').each(function(i, el){\n\t\t\t\t\tvar dataTitulo = $(el).attr('data-titulo');\n\t\t\t\t\tCARTO.nav.append(el, $('#main'));\n\t\t\t\t\t$('#main .mapa img[data-titulo=\"'+dataTitulo+'\"]').css({zIndex:-i});\n\t\t\t\t});\n\t\t\t\tCARTO.nav.checkEmptyInfos();\n\t\t\t},\n\t\t\tisAppended: function(key, data){\n\t\t\t\tvar isAppended = false;\n\t\t\t\tif(key === 'mapa' || key === 'legendas'){\n\t\t\t\t\tisAppended = $('#main img[src=\"'+data+'\"]').length !== 0;\n\t\t\t\t}\n\t\t\t\telse if(key === 'relacionados'){\n\t\t\t\t\tisAppended = $('#main a[href=\"'+data+'\"]').length !== 0;\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tisAppended = $('#main span:contains(\"'+data+'\")').length !== 0;\n\t\t\t\t}\n\t\t\t\treturn isAppended;\n\t\t\t},\n\t\t},\n\t\tsave: {\n\t\t\tbind: function() {\n\t\t\t\t$('.download .download_anchor').on('click', function(el) {\n\t\t\t\t\tvar width = $(el.currentTarget).attr('data-width'),\n\t\t\t\t\t\theight = $(el.currentTarget).attr('data-height');\n\t\t\t\t\tCARTO.save.setup(width, height);\n\t\t\t\t\tvar render = $('#print'),\n\t\t\t\t\t\tfilename = CARTO.save.getFilename();\n\n\t\t\t\t\thtml2canvas(render, {\n\t\t\t\t\t\tallowTaint: true,\n\t\t\t\t\t\tlogging: true,\n\t\t\t\t\t\twidth: width,\n\t\t\t\t\t\theight: height,\n\t\t\t\t\t\tonrendered: function(canvas) {\n\t\t\t\t\t\t\tvar img = canvas.toDataURL('image/png');\n\t\t\t\t\t\t\timg = img.substr(img.indexOf(',') + 1).toString();\n\t\t\t\t\t\t\t$('<form id=\"save_file\" method=\"post\" action=\"' + carto.stylesheet_directory + '/lib/save_canvas.php\"><input type=\"hidden\" value=\"' + img + '\" name=\"canvas\"><input type=\"hidden\" name=\"filename\" value=\"' + filename + '\"><input type=\"submit\"></form>').appendTo('body');\n\t\t\t\t\t\t\t$('#save_file').submit();\n\t\t\t\t\t\t\tCARTO.save.cleanup();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\treturn false;\n\t\t\t\t});\n\t\t\t},\n\t\t\tsetup: function(width, height) {\n\t\t\t\t$('<div id=\"print\"></div>').appendTo('body');\n\t\t\t\t$('#main').clone().appendTo('#print');\n\t\t\t\t$('#print').css({\n\t\t\t\t\twidth: width + 'px',\n\t\t\t\t\theight: height + 'px'\n\t\t\t\t});\n\t\t\t\t$('body').css({\n\t\t\t\t\toverflow: 'hidden'\n\t\t\t\t});\n\t\t\t},\n\t\t\tcleanup: function() {\n\t\t\t\t$('#print').remove();\n\t\t\t\t$('body').css({\n\t\t\t\t\toverflow: 'auto'\n\t\t\t\t});\n\t\t\t\t$('#save_file').remove();\n\t\t\t},\n\t\t\tgetFilename: function() {\n\t\t\t\tvar filename = '';\n\t\t\t\t$('#maps_nav li.active .text').each(function(i, el) {\n\t\t\t\t\tif (i !== 0) {\n\t\t\t\t\t\tfilename += '-';\n\t\t\t\t\t}\n\t\t\t\t\tfilename += $(el).text();\n\t\t\t\t});\n\t\t\t\tfilename = filename.toLowerCase();\n\t\t\t\tfilename = S(filename).latinise().s;\n\t\t\t\treturn filename;\n\t\t\t}\n\t\t}\n\t};\n\n\tCARTO.nav.select();\n\tCARTO.nav.sortable();\n\tCARTO.nav.showNav();\n\tCARTO.nav.expand.bind();\n\tCARTO.preview.bind();\n\tCARTO.nav.filter();\n\tCARTO.save.bind();\n\n})(jQuery);\n"],"sourceRoot":"/source/"}