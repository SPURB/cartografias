!function(n){"use strict";var a={nav:{sortable:function(){n("#maps_nav ul").on("mousedown","li",function(){var e=n(this).outerWidth();n(this).parent().css({width:e})}).on("mouseup","li",function(){n(this).parent().css({width:"auto"})}).sortable({handle:".handle"})},select:function(){n("#maps_nav input").on("click",function(e){n(e.currentTarget).parent().parent().toggleClass("active"),e.stopPropagation()})},filter:function(){n("#filter").on("click",function(t){if(a.nav.anySelected()){n("#maps_nav").toggleClass("filtered");var i="Filtrar"===n(t.currentTarget).find("span").text()?"Ver todos":"Filtrar";n(t.currentTarget).find("span").text(i)}else a.nav.errorButton(n(e.currentTarget))})},append:function(e,t){var i,r,o,s=n(e).data();for(var d in s)if("mapa"===d)a.preview.isAppended(d,s[d])===!1&&n(t).find("."+d).append('<img src="'+s[d]+'">');else if("legendas"===d||"relacionados"===d){if(i="",r=0,"legendas"===d)for(r in s[d])a.preview.isAppended(d,s[d][r].url)===!1&&(i+='<img src="'+s[d][r].url+'">');else if("relacionados"===d)for(r in s[d])o="",r>0&&(o="<span> | </span>"),a.preview.isAppended(d,s[d][r].url)===!1&&(i+=o+'<a href="'+s[d][r].url+'">'+s[d][r].title+"</a>");n(t).find("."+d).append(i)}else a.preview.isAppended(d,s[d])===!1&&(o=n(t).find("."+d+" span").length>0?"<span>, </span>":"",n(t).find("."+d).append(o+"<span>"+s[d]+"</span>"));"main"===n(t).attr("id")&&n(".heading .titulo").html(n("#main .titulo").text()),a.nav.scaleScale(t)},scaleScale:function(e){var a=e.find(".mapa img").eq(0)[0],t=a.naturalWidth,i=a.clientWidth,r=100*i/t/100,o=e.find(".escala")[0],s=o.naturalWidth,d=parseInt(s*r,10);n(o).css({width:d+"px"})},checkEmptyInfos:function(){n(".fonte, .elaboracao, .base").each(function(e,a){0===n(a).find("a").length&&0===n(a).find("span").length?n(a).addClass("hidden"):n(a).removeClass("hidden")}),"Arquivos relacionados"===n.trim(n(".relacionados").text())?n(".relacionados").addClass("hidden"):n(".relacionados").removeClass("hidden")},showNav:function(){n("#maps_nav .toggle").on("click",function(e){n("body").hasClass("show_map")&&n(".show_map").removeClass("show_map")})},expand:{bind:function(){n("li").on("click",function(e){var t=n(e.currentTarget);if(t.toggleClass("expanded"),!t.hasClass("injected")){var i=t.find(".more_info");a.nav.append(t,i),t.addClass("injected")}})}},anySelected:function(){return n("input:checked").length>0},errorButton:function(e){e.addClass("error"),window.setTimeout(function(){n("#save").removeClass("error")},800)}},preview:{bind:function(){n("#preview").on("click",function(e){a.nav.anySelected()?(a.preview.createMap(),n("body").addClass("show_map"),n(".expanded").removeClass("expanded"),n("html, body").css({scrollTop:0})):a.nav.errorButton(n(e.currentTarget))})},createMap:function(){n("#main").find("img, span, a").remove(),n("#maps_nav li.active").each(function(e,t){var i=n(t).attr("data-titulo");a.nav.append(t,n("#main")),n('#main .mapa img[data-titulo="'+i+'"]').css({zIndex:-e})}),a.nav.checkEmptyInfos()},isAppended:function(e,a){var t=!1;return t="mapa"===e||"legendas"===e?0!==n('#main img[src="'+a+'"]').length:"relacionados"===e?0!==n('#main a[href="'+a+'"]').length:0!==n('#main span:contains("'+a+'")').length}},save:{bind:function(){n(".download .download_anchor").on("click",function(e){var t=n(e.currentTarget).attr("data-width"),i=n(e.currentTarget).attr("data-height");a.save.setup(t,i);var r=n("#print"),o=a.save.getFilename();return html2canvas(r,{allowTaint:!0,logging:!0,width:t,height:i,onrendered:function(e){var t=e.toDataURL("image/png");t=t.substr(t.indexOf(",")+1).toString(),n('<form id="save_file" method="post" action="'+carto.stylesheet_directory+'/lib/save_canvas.php"><input type="hidden" value="'+t+'" name="canvas"><input type="hidden" name="filename" value="'+o+'"><input type="submit"></form>').appendTo("body"),n("#save_file").submit(),a.save.cleanup()}}),!1})},setup:function(e,a){n('<div id="print"></div>').appendTo("body"),n("#main").clone().appendTo("#print"),n("#print").css({width:e+"px",height:a+"px"}),n("body").css({overflow:"hidden"})},cleanup:function(){n("#print").remove(),n("body").css({overflow:"auto"}),n("#save_file").remove()},getFilename:function(){var e="";return n("#maps_nav li.active .text").each(function(a,t){0!==a&&(e+="-"),e+=n(t).text()}),e=e.toLowerCase(),e=S(e).latinise().s}}};a.nav.select(),a.nav.sortable(),a.nav.showNav(),a.nav.expand.bind(),a.preview.bind(),a.nav.filter(),a.save.bind()}(jQuery);
//# sourceMappingURL=main.min.js.map